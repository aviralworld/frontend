ARG NODE_VERSION

FROM node:$NODE_VERSION AS build

ARG REVISION
ARG TIMESTAMP

LABEL timestamp=$TIMESTAMP revision=$REVISION

# workaround
ENV FRONTEND_API_URL=1
ENV FRONTEND_DEBOUNCE_DELAY_MS=1
ENV FRONTEND_ENABLE_ADMIN_MODE=1
ENV FRONTEND_RANDOM_STORY_COUNT=1
ENV FRONTEND_SERVE_STATIC=1
ENV FRONTEND_COMPRESSION=1
ENV FRONTEND_ADMIN_PORT=1
ENV FRONTEND_HEALTH_CHECK_TIMEOUT_MS=1

WORKDIR /app

COPY . .

RUN npm i -g pnpm && pnpm i -s --frozen-lockfile && pnpm run build && pnpm run hash
